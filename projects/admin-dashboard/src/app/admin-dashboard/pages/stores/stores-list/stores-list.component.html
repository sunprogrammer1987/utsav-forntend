<div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
  <div class="flex flex-wrap items-center justify-between mb-5 gap-3">
    <h2 class="text-2xl font-semibold">Stores</h2>

    <form class="flex flex-wrap items-center gap-2">
      <!-- Vendor Filter -->
      <mat-form-field appearance="outline" class="w-48">
        <mat-label>Filter by Vendor</mat-label>
        <mat-select [(ngModel)]="selectedVendor" (selectionChange)="onVendorChange()">
          <mat-option value="all">All Vendors</mat-option>
          <mat-option *ngFor="let v of vendors" [value]="v._id">{{ v.shopName }}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Add Event -->
      <button mat-flat-button color="primary" type="button" (click)="openForm()">+ Add Store</button>
    </form>
  </div>

  <table mat-table [dataSource]="stores" class="w-full mat-elevation-z2">
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Store Name</th>
      <td mat-cell *matCellDef="let s">{{ s.name }}</td>
    </ng-container>

    <ng-container matColumnDef="vendor">
      <th mat-header-cell *matHeaderCellDef>Vendor</th>
      <td mat-cell *matCellDef="let s">{{ s.vendorShopName }}</td>
    </ng-container>

    <ng-container matColumnDef="city">
      <th mat-header-cell *matHeaderCellDef>City</th>
      <td mat-cell *matCellDef="let s">{{ s.city || '-' }}</td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Status</th>
      <td mat-cell *matCellDef="let s">
        <span class="px-2 py-1 rounded text-xs"
          [ngClass]="s.isActive ? 'bg-green-100 text-green-800' : 'bg-gray-200 text-gray-700'">
          {{ s.isActive ? 'Active' : 'Inactive' }}
        </span>
      </td>
    </ng-container>

    <ng-container matColumnDef="createdAt">
      <th mat-header-cell *matHeaderCellDef>Created</th>
      <td mat-cell *matCellDef="let s">{{ s.createdAt | date:'medium' }}</td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>actions</th>
      <td mat-cell *matCellDef="let s">
        <button mat-icon-button color="primary" (click)="openForm(s)"><mat-icon>edit</mat-icon></button>
        <button mat-icon-button color="warn" (click)="toggle(s)">
          <mat-icon>{{ s.isActive ? 'toggle_on' : 'toggle_off' }}</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  <div *ngIf="!stores.length && !loading" class="text-center py-6 text-gray-500">No stores found.</div>
  <div *ngIf="loading" class="text-center py-6"><mat-progress-spinner diameter="40"
      mode="indeterminate"></mat-progress-spinner></div>
</div>