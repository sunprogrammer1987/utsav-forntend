
<div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
  <div class="flex flex-wrap items-end justify-between mb-4 gap-4">
    <h2 class="text-xl font-semibold">Event Bookings</h2>
    <!-- Filters -->
    <div class="flex flex-wrap items-center gap-3">
      <!-- Vendor -->
      <mat-form-field appearance="outline" class="w-44">
        <mat-label>Vendor</mat-label>
        <mat-select [(ngModel)]="selectedVendor" (selectionChange)="onVendorChange()">
          <mat-option value="">All</mat-option>
          <mat-option *ngFor="let v of vendors" [value]="v._id">{{ v.shopName }}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Store -->
      <mat-form-field appearance="outline" class="w-44">
        <mat-label>Store</mat-label>
        <mat-select [(ngModel)]="selectedStore" (selectionChange)="loadBookings()">
          <mat-option value="">All</mat-option>
          <mat-option *ngFor="let s of stores" [value]="s._id">{{ s.name }}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Status -->
      <mat-form-field appearance="outline" class="w-44">
        <mat-label>Status</mat-label>
        <mat-select [(value)]="selectedStatus" (selectionChange)="loadBookings()">
          <mat-option value="">All</mat-option>
          <mat-option value="Pending">Pending</mat-option>
          <mat-option value="Confirmed">Confirmed</mat-option>
          <mat-option value="Cancelled">Cancelled</mat-option>
          <mat-option value="Completed">Completed</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Date Range -->
      <mat-form-field appearance="outline" class="w-44">
        <mat-label>From</mat-label>
        <input matInput [matDatepicker]="picker1" [(ngModel)]="fromDate">
        <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
        <mat-datepicker #picker1></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-44">
        <mat-label>To</mat-label>
        <input matInput [matDatepicker]="picker2" [(ngModel)]="toDate">
        <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
        <mat-datepicker #picker2></mat-datepicker>
      </mat-form-field>

      <!-- Buttons -->
      <button mat-flat-button color="primary" (click)="loadBookings()">
        <mat-icon>filter_alt</mat-icon> Apply
      </button>
      <button mat-stroked-button color="warn" (click)="resetFilters()">
        <mat-icon>refresh</mat-icon> Reset
      </button>
    </div>
  </div>

  <!-- Loader -->
  <mat-progress-spinner *ngIf="loading" diameter="40" mode="indeterminate" class="mx-auto"></mat-progress-spinner>

  <!-- Table -->
  <div *ngIf="!loading && bookings.length">
    <table mat-table [dataSource]="bookings" class="w-full">
      <ng-container matColumnDef="bookingId">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let b">{{ b._id | slice: 0:8 }}...</td>
      </ng-container>

      <ng-container matColumnDef="seller">
        <th mat-header-cell *matHeaderCellDef>Seller</th>
        <td mat-cell *matCellDef="let b">{{ b.vendor?.shopName}}</td>
      </ng-container>

      <ng-container matColumnDef="store">
        <th mat-header-cell *matHeaderCellDef>Store</th>
        <td mat-cell *matCellDef="let b">{{ b.store?.name}}</td>
      </ng-container>

      <ng-container matColumnDef="event">
        <th mat-header-cell *matHeaderCellDef>Event</th>
        <td mat-cell *matCellDef="let b">{{ b.eventPackage?.name }}</td>
      </ng-container>

      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Price</th>
        <td mat-cell *matCellDef="let b">â‚¹{{ b.price }}</td>
      </ng-container>

      <ng-container matColumnDef="eventDate">
        <th mat-header-cell *matHeaderCellDef>Event Date</th>
        <td mat-cell *matCellDef="let b">{{ b.date | date: 'mediumDate' }}</td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let b">
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="updateStatus(b, 'Pending')">Pending</button>
            <button mat-menu-item (click)="updateStatus(b, 'Confirmed')">Confirmed</button>
            <button mat-menu-item (click)="updateStatus(b, 'Cancelled')">Cancelled</button>
            <button mat-menu-item (click)="updateStatus(b, 'Completed')">Completed</button>
          </mat-menu>
          <button mat-stroked-button [matMenuTriggerFor]="menu">
            {{ b.status }}
            <mat-icon>arrow_drop_down</mat-icon>
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let b">
          <button mat-icon-button color="primary" (click)="viewDetails(b)">
            <mat-icon>visibility</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>

  <div *ngIf="!loading && !bookings.length" class="text-center text-gray-500 py-8">
    No event bookings found.
  </div>
</div>
