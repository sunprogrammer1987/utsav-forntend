<div class="p-4">
  <!-- Summary Bar -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg shadow-sm">
      <div class="text-sm text-gray-600">Total Orders</div>
      <div class="text-2xl font-semibold text-blue-600">{{ summary.totalOrders || 0 }}</div>
    </div>
    <div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg shadow-sm">
      <div class="text-sm text-gray-600">Total Sales</div>
      <div class="text-2xl font-semibold text-green-600">â‚¹{{ summary.totalSales || 0 }}</div>
    </div>
    <div class="bg-yellow-50 dark:bg-yellow-900/30 p-4 rounded-lg shadow-sm">
      <div class="text-sm text-gray-600">Pending</div>
      <div class="text-2xl font-semibold text-yellow-600">{{ summary.pending || 0 }}</div>
    </div>
    <div class="bg-indigo-50 dark:bg-indigo-900/30 p-4 rounded-lg shadow-sm">
      <div class="text-sm text-gray-600">Delivered</div>
      <div class="text-2xl font-semibold text-indigo-600">{{ summary.delivered || 0 }}</div>
    </div>
  </div>


  <mat-tab-group [(selectedIndex)]="tabIndex" class="mb-6">
    <!-- ðŸ›ï¸ Product Orders Tab -->
    <mat-tab label="Product Orders">
      <div class="mt-4">
        <!-- Filters -->
        <div class="flex flex-wrap items-end justify-between mb-4 gap-4">
          <div class="flex gap-3">
            <mat-form-field appearance="outline" class="w-44">
              <mat-label>Status</mat-label>
              <mat-select [(value)]="selectedStatus" (selectionChange)="loadOrders()">
                <mat-option value="">All</mat-option>
                <mat-option value="pending">Pending</mat-option>
                <mat-option value="processing">Processing</mat-option>
                <mat-option value="delivered">Delivered</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-44">
              <mat-label>From</mat-label>
              <input matInput [matDatepicker]="picker1" [(ngModel)]="fromDate" />
              <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
              <mat-datepicker #picker1></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-44">
              <mat-label>To</mat-label>
              <input matInput [matDatepicker]="picker2" [(ngModel)]="toDate" />
              <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
              <mat-datepicker #picker2></mat-datepicker>
            </mat-form-field>

            <button mat-flat-button color="primary" (click)="loadOrders()">
              <mat-icon>filter_alt</mat-icon> Apply
            </button>
            <button mat-stroked-button color="warn" (click)="resetFilters()">
              <mat-icon>refresh</mat-icon> Reset
            </button>
          </div>

          <div class="flex gap-2">
            <button mat-stroked-button color="primary" (click)="exportToExcel()">
              <mat-icon>file_present</mat-icon> Excel
            </button>
            <button mat-flat-button color="warn" (click)="exportToPDF()">
              <mat-icon>picture_as_pdf</mat-icon> PDF
            </button>
          </div>
        </div>

        <!-- Orders Table -->
        <mat-progress-spinner *ngIf="loading" mode="indeterminate"></mat-progress-spinner>

        <div *ngIf="!loading && orders.length">
          <table mat-table [dataSource]="orders" class="mat-elevation-z8 w-full">

            <ng-container matColumnDef="orderId">
              <th mat-header-cell *matHeaderCellDef>Order ID</th>
              <td mat-cell *matCellDef="let o">{{ o._id | slice:0:8 }}...</td>
            </ng-container>

            <ng-container matColumnDef="store">
              <th mat-header-cell *matHeaderCellDef>Store</th>
              <td mat-cell *matCellDef="let o">{{ o.store?.name || '-' }}</td>
            </ng-container>

            <ng-container matColumnDef="customer">
              <th mat-header-cell *matHeaderCellDef>Customer</th>
              <td mat-cell *matCellDef="let o">{{ o.customer?.name || 'Guest' }}</td>
            </ng-container>

            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef>Amount</th>
              <td mat-cell *matCellDef="let o">â‚¹{{ o.total | number:'1.2-2' }}</td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let o">
                <mat-menu #menu="matMenu">
                  <button mat-menu-item (click)="updateStatus(o, 'pending')">Pending</button>
                  <button mat-menu-item (click)="updateStatus(o, 'processing')">Processing</button>
                  <button mat-menu-item (click)="updateStatus(o, 'delivered')">Delivered</button>
                </mat-menu>
                <button mat-stroked-button [matMenuTriggerFor]="menu">
                  {{ o.orderStatus | titlecase }}
                  <mat-icon>arrow_drop_down</mat-icon>
                </button>
              </td>
            </ng-container>

            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let o">{{ o.createdAt | date:'mediumDate' }}</td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let o">
                <button mat-icon-button color="primary" (click)="viewDetails(o)">
                  <mat-icon>visibility</mat-icon>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>

        <div *ngIf="!loading && !orders.length" class="text-center text-gray-500 py-8">
          No orders found.
        </div>
      </div>
    </mat-tab>

    <!-- ðŸŽ‰ Event Bookings Tab -->
    <mat-tab label="Event Bookings">
      <div class="mt-4">
        <app-bookings></app-bookings>
      </div>
    </mat-tab>

  </mat-tab-group>
</div>